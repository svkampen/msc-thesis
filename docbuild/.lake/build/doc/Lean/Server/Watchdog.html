<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Server.Watchdog</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Server.Watchdog";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init/Data/ByteArray.html">Init.Data.ByteArray</a></li><li><a href="../.././Init/System/IO.html">Init.System.IO</a></li><li><a href="../.././Init/System/Mutex.html">Init.System.Mutex</a></li><li><a href="../.././Lean/Data/FuzzyMatching.html">Lean.Data.FuzzyMatching</a></li><li><a href="../.././Lean/Data/Json.html">Lean.Data.Json</a></li><li><a href="../.././Lean/Data/Lsp.html">Lean.Data.Lsp</a></li><li><a href="../.././Lean/Data/RBMap.html">Lean.Data.RBMap</a></li><li><a href="../.././Lean/Server/References.html">Lean.Server.References</a></li><li><a href="../.././Lean/Server/Requests.html">Lean.Server.Requests</a></li><li><a href="../.././Lean/Server/Utils.html">Lean.Server.Utils</a></li><li><a href="../.././Lean/Util/Paths.html">Lean.Util.Paths</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Server.Watchdog" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.workerCfg"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">workerCfg</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.WorkerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerEvent</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.CrashOrigin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CrashOrigin</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingRequestMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.stdin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdin</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.stdout"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdout</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.erasePendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">erasePendingRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.errorPendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">errorPendingRequests</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.queuedMsgs"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">queuedMsgs</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.waitForProc"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">waitForProc</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.killProcAndWait"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">killProcAndWait</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorkerMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorkerMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ImportMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ImportData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ImportData.update"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span>.<span class="name">update</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ImportData.eraseImportsOf"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span>.<span class="name">eraseImportsOf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.RequestIDTranslation"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">RequestIDTranslation</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.PendingServerRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingServerRequestMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerRequestData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerRequestData.trackOutboundRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span>.<span class="name">trackOutboundRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerRequestData.translateInboundResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span>.<span class="name">translateInboundResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.updateFileWorkers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">updateFileWorkers</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findFileWorker?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.eraseFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">eraseFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.log"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">log</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleIleanInfoUpdate"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoUpdate</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleIleanInfoFinal"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoFinal</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleImportClosure"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleImportClosure</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.startFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.terminateFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">terminateFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCrash"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCrash</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.tryDischargeQueuedMessages"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryDischargeQueuedMessages</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.tryWriteMessage"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryWriteMessage</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.notifyAboutStaleDependency"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">notifyAboutStaleDependency</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findDefinitions"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findDefinitions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleReference"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleReference</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.CallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CallHierarchyItemData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.instFromJsonCallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">instFromJsonCallHierarchyItemData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.instToJsonCallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">instToJsonCallHierarchyItemData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.CallHierarchyItemData.fromItem?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CallHierarchyItemData</span>.<span class="name">fromItem?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handlePrepareCallHierarchy"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handlePrepareCallHierarchy</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCallHierarchyIncomingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyIncomingCalls</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCallHierarchyIncomingCalls.collapseSameIncomingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyIncomingCalls</span>.<span class="name">collapseSameIncomingCalls</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyOutgoingCalls</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls.collapseSameOutgoingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyOutgoingCalls</span>.<span class="name">collapseSameOutgoingCalls</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleWorkspaceSymbol"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleWorkspaceSymbol</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handlePrepareRename"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handlePrepareRename</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleRename"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRename</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidOpen"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidOpen</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidSave"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidSave</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidClose"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidClose</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidChangeWatchedFiles"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChangeWatchedFiles</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCancelRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.forwardNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">parseParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.forwardRequestToWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardRequestToWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleResponseError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.shutdown"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">shutdown</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerEvent</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.runClientTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">runClientTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mainLoop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.mkLeanServerCapabilities"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mkLeanServerCapabilities</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.initAndRunWatchdogAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdogAux</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findWorkerPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findWorkerPath</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.startLoadingReferences"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startLoadingReferences</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.initAndRunWatchdog"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.watchdogMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">watchdogMain</span></a></div></nav><main>
<div class="mod_doc"><p>For general server architecture, see <code>README.md</code>. This module implements the watchdog process.</p><h2 class="markdown-heading" id="Watchdog-state">Watchdog state <a class="hover-link" href="#Watchdog-state">#</a></h2><p>Most LSP clients only send us file diffs, so to facilitate sending entire file contents to freshly
restarted workers, the watchdog needs to maintain the current state of each file. It can also use
this state to detect changes to the header and thus restart the corresponding worker, freeing its
imports.</p><p>TODO(WN):
We may eventually want to keep track of approximately (since this isn't knowable exactly) where in
the file a worker crashed. Then on restart, we tell said worker to only parse up to that point and
query the user about how to proceed (continue OR allow the user to fix the bug and then continue OR
..). Without this, if the crash is deterministic, users may be confused about why the server
seemingly stopped working for a single file.</p><h2 class="markdown-heading" id="Watchdog-&lt;-&gt;-worker-communication">Watchdog &lt;-&gt; worker communication <a class="hover-link" href="#Watchdog-&lt;-&gt;-worker-communication">#</a></h2><p>The watchdog process and its file worker processes communicate via LSP. If the necessity arises, we
might add non-standard commands similarly based on JSON-RPC. Most requests and notifications are
forwarded to the corresponding file worker process, with the exception of these notifications:</p><ul>
<li>textDocument/didOpen: Launch the file worker, create the associated watchdog state and launch a
task to asynchronously receive LSP packets from the worker (e.g. request
responses).</li>
<li>textDocument/didChange: Update the local file state so that it can be resent to restarted workers.
Then forward the <code>didChange</code> notification.</li>
<li>textDocument/didClose: Signal a shutdown to the file worker and remove the associated watchdog
state.</li>
</ul><p>Moreover, we don't implement the full protocol at this level:</p><ul>
<li>Upon starting, the <code>initialize</code> request is forwarded to the worker, but it must not respond with
its server capabilities. Consequently, the watchdog will not send an <code>initialized</code> notification to
the worker.</li>
<li>After <code>initialize</code>, the watchdog sends the corresponding <code>didOpen</code> notification with the full
current state of the file. No additional <code>didOpen</code> notifications will be forwarded to the worker
process.</li>
<li><code>$/cancelRequest</code> notifications are forwarded to all file workers.</li>
<li>File workers are always terminated with an <code>exit</code> notification, without previously receiving a
<code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.shutdown">shutdown</a></code> request. Similarly, they never receive a <code>didClose</code> notification.</li>
</ul><h2 class="markdown-heading" id="Watchdog-&lt;-&gt;-client-communication">Watchdog &lt;-&gt; client communication <a class="hover-link" href="#Watchdog-&lt;-&gt;-client-communication">#</a></h2><p>The watchdog itself should implement the LSP standard as closely as possible. However we reserve the
right to add non-standard extensions in case they're needed, for example to communicate tactic
state.</p></div><div class="decl" id="Lean.Server.Watchdog.workerCfg"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L80-L85">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">workerCfg</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.Process.StdioConfig">IO.Process.StdioConfig</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg">Lean.Server.Watchdog.workerCfg</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">stdin</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a>, <span class="fn">stdout</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a>, <span class="fn">stderr</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.inherit">IO.Process.Stdio.inherit</a> }</span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.workerCfg" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.WorkerEvent"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L87-L92">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerEvent</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Events that worker-specific tasks signal to the main thread.</p><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.terminated">terminated: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.importsChanged">importsChanged: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.crashed">crashed: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.ioError">ioError: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></li></ul><details id="instances-for-list-Lean.Server.Watchdog.WorkerEvent" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.CrashOrigin"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L94-L96">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CrashOrigin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CrashOrigin</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.CrashOrigin.fileWorkerToClientForwarding">fileWorkerToClientForwarding: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CrashOrigin">Lean.Server.Watchdog.CrashOrigin</a></li><li class="constructor" id="Lean.Server.Watchdog.CrashOrigin.clientToFileWorkerForwarding">clientToFileWorkerForwarding: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CrashOrigin">Lean.Server.Watchdog.CrashOrigin</a></li></ul><details id="instances-for-list-Lean.Server.Watchdog.CrashOrigin" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.WorkerState"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L98-L107">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.WorkerState.crashed">crashed: <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span> → <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CrashOrigin">Lean.Server.Watchdog.CrashOrigin</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></span></span><div class="inductive_ctor_doc"><p>The watchdog can detect a crashed file worker in two places: When trying to send a message
to the file worker and when reading a request reply.
In the latter case, the forwarding task terminates and delegates a <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> event to the
main task. Then, in both cases, the file worker has its state set to <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> and requests
that are in-flight are errored. Upon receiving the next packet for that file worker, the file
worker is restarted and the packet is forwarded to it. If the crash was detected while writing
a packet, we queue that packet until the next packet for the file worker arrives.</p></div></li><li class="constructor" id="Lean.Server.Watchdog.WorkerState.running">running: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></li></ul><details id="instances-for-list-Lean.Server.Watchdog.WorkerState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.PendingRequestMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L109-L109">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingRequestMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap">Lean.Server.Watchdog.PendingRequestMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a> <span class="fn">compare</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.PendingRequestMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L113-L125">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.FileWorker.mk"><li id="Lean.Server.Watchdog.FileWorker.doc" class="structure_field"><div class="structure_field_info">doc : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a></div></li><li id="Lean.Server.Watchdog.FileWorker.proc" class="structure_field"><div class="structure_field_info">proc : <span class="fn"><a href="../.././Init/System/IO.html#IO.Process.Child">IO.Process.Child</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg">Lean.Server.Watchdog.workerCfg</a></span></div></li><li id="Lean.Server.Watchdog.FileWorker.exitCode" class="structure_field"><div class="structure_field_info">exitCode : <span class="fn"><a href="../.././Init/System/Mutex.html#IO.Mutex">IO.Mutex</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a>)</span></span></div></li><li id="Lean.Server.Watchdog.FileWorker.commTask" class="structure_field"><div class="structure_field_info">commTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></div></li><li id="Lean.Server.Watchdog.FileWorker.state" class="structure_field"><div class="structure_field_info">state : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></div></li><li id="Lean.Server.Watchdog.FileWorker.pendingRequestsRef" class="structure_field"><div class="structure_field_info">pendingRequestsRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap">Lean.Server.Watchdog.PendingRequestMap</a></span></div><div class="structure_field_doc"><p>The pending requests map contains all requests that have been received from the LSP client,
but were not answered yet.
We need them for forwarding cancellation requests to the correct worker as well as cleanly
aborting requests on worker crashes.</p></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.FileWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.stdin"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L129-L130">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdin</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">fw</span>.stdin</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.FS.Stream.ofHandle">IO.FS.Stream.ofHandle</a> <span class="fn"><span class="fn"><span class="fn">fw</span>.proc</span>.stdin</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.stdin" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.stdout"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L132-L133">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdout"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdout</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">fw</span>.stdout</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.FS.Stream.ofHandle">IO.FS.Stream.ofHandle</a> <span class="fn"><span class="fn"><span class="fn">fw</span>.proc</span>.stdout</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.stdout" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.erasePendingRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L135-L136">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.erasePendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">erasePendingRequest</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">fw</span>.erasePendingRequest</span> <span class="fn">id</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.modify">ST.Ref.modify</a> <span class="fn"><span class="fn">fw</span>.pendingRequestsRef</span> <span class="fn">fun (<span class="fn">pendingRequests</span> : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap">Lean.Server.Watchdog.PendingRequestMap</a>) =&gt;
    <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.erase">Lean.RBMap.erase</a> <span class="fn">pendingRequests</span> <span class="fn">id</span></span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.erasePendingRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.errorPendingRequests"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L138-L143">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.errorPendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">errorPendingRequests</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(hError : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(code : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode">Lean.JsonRpc.ErrorCode</a>)</span></span>
<span class="decl_args">
<span class="fn">(msg : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.errorPendingRequests" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.queuedMsgs"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L145-L148">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.queuedMsgs"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">queuedMsgs</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">fw</span>.queuedMsgs</span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><span class="fn">fw</span>.state</span> with
  | <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState.running">Lean.Server.Watchdog.WorkerState.running</a> =&gt; <span class="fn">#[]</span>
  | <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState.crashed">Lean.Server.Watchdog.WorkerState.crashed</a> <span class="fn">queuedMsgs</span> <span class="fn">origin</span></span> =&gt; <span class="fn">queuedMsgs</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.queuedMsgs" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.waitForProc"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L150-L158">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.waitForProc"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">waitForProc</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.waitForProc" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.killProcAndWait"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L160-L170">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.killProcAndWait"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">killProcAndWait</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorker.killProcAndWait" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorkerMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L177-L177">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorkerMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap">Lean.Server.Watchdog.FileWorkerMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a> <span class="fn">compare</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.FileWorkerMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ImportMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L178-L178">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportMap">Lean.Server.Watchdog.ImportMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a> <span class="fn">(<a href="../.././Lean/Data/RBTree.html#Lean.RBTree">Lean.RBTree</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a> <span class="fn">compare</span>)</span> <span class="fn">compare</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ImportMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ImportData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L180-L185">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Global import data for all open files managed by this watchdog.</p><ul class="structure_fields" id="Lean.Server.Watchdog.ImportData.mk"><li id="Lean.Server.Watchdog.ImportData.imports" class="structure_field"><div class="structure_field_info">imports : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportMap">Lean.Server.Watchdog.ImportMap</a></div><div class="structure_field_doc"><p>For every open file, the files that it imports.</p></div></li><li id="Lean.Server.Watchdog.ImportData.importedBy" class="structure_field"><div class="structure_field_info">importedBy : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportMap">Lean.Server.Watchdog.ImportMap</a></div><div class="structure_field_doc"><p>For every open file, the files that it is imported by.</p></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.ImportData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ImportData.update"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L187-L214">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData.update"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span>.<span class="name">update</span></a></span><span class="decl_args">
<span class="fn">(d : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData">Lean.Server.Watchdog.ImportData</a>)</span></span>
<span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href="../.././Lean/Data/RBTree.html#Lean.RBTree">Lean.RBTree</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a> <span class="fn">compare</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData">Lean.Server.Watchdog.ImportData</a></div></div><p>Updates <code>d</code> with the new set of <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData.imports">imports</a></code> for the file <code>uri</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ImportData.update" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ImportData.eraseImportsOf"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L216-L220">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData.eraseImportsOf"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ImportData</span>.<span class="name">eraseImportsOf</span></a></span><span class="decl_args">
<span class="fn">(d : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData">Lean.Server.Watchdog.ImportData</a>)</span></span>
<span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData">Lean.Server.Watchdog.ImportData</a></div></div><p>Sets the imports of <code>uri</code> in <code>d</code> to the empty set.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn"><span class="fn">d</span>.eraseImportsOf</span> <span class="fn">uri</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">d</span>.update</span> <span class="fn">uri</span> <a href="../.././Init/Core.html#EmptyCollection.emptyCollection">∅</a></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ImportData.eraseImportsOf" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.RequestIDTranslation"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L222-L224">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.RequestIDTranslation"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">RequestIDTranslation</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.RequestIDTranslation.mk"><li id="Lean.Server.Watchdog.RequestIDTranslation.sourceUri" class="structure_field"><div class="structure_field_info">sourceUri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a></div></li><li id="Lean.Server.Watchdog.RequestIDTranslation.localID" class="structure_field"><div class="structure_field_info">localID : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.RequestIDTranslation" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.PendingServerRequestMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L226-L226">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingServerRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingServerRequestMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingServerRequestMap">Lean.Server.Watchdog.PendingServerRequestMap</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.RequestIDTranslation">Lean.Server.Watchdog.RequestIDTranslation</a> <span class="fn">compare</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.PendingServerRequestMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerRequestData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L228-L230">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.ServerRequestData.mk"><li id="Lean.Server.Watchdog.ServerRequestData.pendingServerRequests" class="structure_field"><div class="structure_field_info">pendingServerRequests : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingServerRequestMap">Lean.Server.Watchdog.PendingServerRequestMap</a></div></li><li id="Lean.Server.Watchdog.ServerRequestData.freshServerRequestID" class="structure_field"><div class="structure_field_info">freshServerRequestID : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.ServerRequestData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerRequestData.trackOutboundRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L232-L242">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData.trackOutboundRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span>.<span class="name">trackOutboundRequest</span></a></span><span class="decl_args">
<span class="fn">(data : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData">Lean.Server.Watchdog.ServerRequestData</a>)</span></span>
<span class="decl_args">
<span class="fn">(sourceUri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(localID : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData">Lean.Server.Watchdog.ServerRequestData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ServerRequestData.trackOutboundRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerRequestData.translateInboundResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L244-L250">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData.translateInboundResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerRequestData</span>.<span class="name">translateInboundResponse</span></a></span><span class="decl_args">
<span class="fn">(data : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData">Lean.Server.Watchdog.ServerRequestData</a>)</span></span>
<span class="decl_args">
<span class="fn">(globalID : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.RequestIDTranslation">Lean.Server.Watchdog.RequestIDTranslation</a></span> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData">Lean.Server.Watchdog.ServerRequestData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ServerRequestData.translateInboundResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L252-L265">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.ServerContext.mk"><li id="Lean.Server.Watchdog.ServerContext.hIn" class="structure_field"><div class="structure_field_info">hIn : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.hOut" class="structure_field"><div class="structure_field_info">hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.hLog" class="structure_field"><div class="structure_field_info">hLog : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.args" class="structure_field"><div class="structure_field_info">args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div><div class="structure_field_doc"><p>Command line arguments.</p></div></li><li id="Lean.Server.Watchdog.ServerContext.fileWorkersRef" class="structure_field"><div class="structure_field_info">fileWorkersRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap">Lean.Server.Watchdog.FileWorkerMap</a></span></div></li><li id="Lean.Server.Watchdog.ServerContext.initParams" class="structure_field"><div class="structure_field_info">initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lean.Lsp.InitializeParams</a></div><div class="structure_field_doc"><p>We store these to pass them to workers.</p></div></li><li id="Lean.Server.Watchdog.ServerContext.workerPath" class="structure_field"><div class="structure_field_info">workerPath : <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a></div></li><li id="Lean.Server.Watchdog.ServerContext.srcSearchPath" class="structure_field"><div class="structure_field_info">srcSearchPath : <a href="../.././Init/System/FilePath.html#System.SearchPath">System.SearchPath</a></div></li><li id="Lean.Server.Watchdog.ServerContext.references" class="structure_field"><div class="structure_field_info">references : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/References.html#Lean.Server.References">Lean.Server.References</a></span></div></li><li id="Lean.Server.Watchdog.ServerContext.serverRequestData" class="structure_field"><div class="structure_field_info">serverRequestData : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerRequestData">Lean.Server.Watchdog.ServerRequestData</a></span></div></li><li id="Lean.Server.Watchdog.ServerContext.importData" class="structure_field"><div class="structure_field_info">importData : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ImportData">Lean.Server.Watchdog.ImportData</a></span></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.ServerContext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L267-L267">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerContext">Lean.Server.Watchdog.ServerContext</a> <a href="../.././Init/System/IO.html#IO">IO</a></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.ServerM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.updateFileWorkers"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L269-L270">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.updateFileWorkers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">updateFileWorkers</span></a></span><span class="decl_args">
<span class="fn">(val : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.updateFileWorkers" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findFileWorker?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L272-L273">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findFileWorker?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker?</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findFileWorker?">Lean.Server.Watchdog.findFileWorker?</a> <span class="fn">uri</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn">read</span>
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <span class="fn"><span class="fn">__do_lift</span>.fileWorkersRef</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(<a href="../.././Lean/Data/RBMap.html#Lean.RBMap.find?">Lean.RBMap.find?</a> <span class="fn">__do_lift</span> <span class="fn">uri</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.findFileWorker?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.eraseFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L275-L281">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.eraseFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">eraseFileWorker</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.eraseFileWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.log"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L283-L286">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.log"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">log</span></a></span><span class="decl_args">
<span class="fn">(msg : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.log">Lean.Server.Watchdog.log</a> <span class="fn">msg</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">st</span> ← <span class="fn">read</span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn"><span class="fn"><span class="fn">st</span>.hLog</span>.putStrLn</span> <span class="fn">msg</span>)</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn"><span class="fn"><span class="fn">st</span>.hLog</span>.flush</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.log" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleIleanInfoUpdate"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L288-L293">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleIleanInfoUpdate"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoUpdate</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanIleanInfoParams">Lean.Lsp.LeanIleanInfoParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleIleanInfoUpdate" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleIleanInfoFinal"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L295-L300">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleIleanInfoFinal"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoFinal</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanIleanInfoParams">Lean.Lsp.LeanIleanInfoParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleIleanInfoFinal" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleImportClosure"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L302-L309">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleImportClosure"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleImportClosure</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanImportClosureParams">Lean.Lsp.LeanImportClosureParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Updates the global import data with the import closure provided by the file worker after it
successfully processed its header.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleImportClosure" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.startFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L385-L430">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.startFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startFileWorker</span></a></span><span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.startFileWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.terminateFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L432-L445">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.terminateFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">terminateFileWorker</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.terminateFileWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCrash"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L447-L450">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCrash"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCrash</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(queuedMsgs : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(origin : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CrashOrigin">Lean.Server.Watchdog.CrashOrigin</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCrash" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.tryDischargeQueuedMessages"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L452-L463">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.tryDischargeQueuedMessages"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryDischargeQueuedMessages</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(queuedMsgs : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.tryDischargeQueuedMessages" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.tryWriteMessage"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L465-L498">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.tryWriteMessage"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryWriteMessage</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(msg : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a>)</span></span>
<span class="decl_args">
<span class="fn">(queueFailedMessage : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args">
<span class="fn">(restartCrashedWorker : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Tries to write a message, sets the state of the FileWorker to <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> if it does not succeed
and restarts the file worker if the <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> flag was already set. Just logs an error if
there is no FileWorker at this <code>uri</code>.
Messages that couldn't be sent can be queued up via the queueFailedMessage flag and
will be discharged after the FileWorker is restarted.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.tryWriteMessage" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.notifyAboutStaleDependency"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L500-L510">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.notifyAboutStaleDependency"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">notifyAboutStaleDependency</span></a></span><span class="decl_args">
<span class="fn">(uri staleDependency : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Sends a notification to the file worker identified by <code>uri</code> that its dependency <code>staleDependency</code>
is out-of-date.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.notifyAboutStaleDependency" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findDefinitions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L517-L526">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findDefinitions"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findDefinitions</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.TextDocumentPositionParams">Lean.Lsp.TextDocumentPositionParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Location">Lean.Lsp.Location</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.findDefinitions" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleReference"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L528-L538">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleReference"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleReference</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.ReferenceParams">Lean.Lsp.ReferenceParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Location">Lean.Lsp.Location</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleReference" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.CallHierarchyItemData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L540-L547">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CallHierarchyItemData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Used in <code>CallHierarchyItem.data?</code> to retain all the data needed to quickly re-identify the
call hierarchy item.</p><ul class="structure_fields" id="Lean.Server.Watchdog.CallHierarchyItemData.mk"><li id="Lean.Server.Watchdog.CallHierarchyItemData.module" class="structure_field"><div class="structure_field_info">module : <a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="Lean.Server.Watchdog.CallHierarchyItemData.name" class="structure_field"><div class="structure_field_info">name : <a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li></ul><details id="instances-for-list-Lean.Server.Watchdog.CallHierarchyItemData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.instFromJsonCallHierarchyItemData"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L547-L547">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.instFromJsonCallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">instFromJsonCallHierarchyItemData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData">Lean.Server.Watchdog.CallHierarchyItemData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.instFromJsonCallHierarchyItemData">Lean.Server.Watchdog.instFromJsonCallHierarchyItemData</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">fromJson?</span> := <a href="../.././Lean/Server/Watchdog.html#_private.Lean.Server.Watchdog.0.Lean.Server.Watchdog.fromJsonCallHierarchyItemData._@.Lean.Server.Watchdog._hyg.4170">Lean.Server.Watchdog.fromJsonCallHierarchyItemData✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.instToJsonCallHierarchyItemData"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L547-L547">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.instToJsonCallHierarchyItemData"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">instToJsonCallHierarchyItemData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">Lean.ToJson</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData">Lean.Server.Watchdog.CallHierarchyItemData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.instToJsonCallHierarchyItemData">Lean.Server.Watchdog.instToJsonCallHierarchyItemData</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">{ <span class="fn">toJson</span> := <a href="../.././Lean/Server/Watchdog.html#_private.Lean.Server.Watchdog.0.Lean.Server.Watchdog.toJsonCallHierarchyItemData._@.Lean.Server.Watchdog._hyg.4276">Lean.Server.Watchdog.toJsonCallHierarchyItemData✝</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.CallHierarchyItemData.fromItem?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L549-L553">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData.fromItem?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">CallHierarchyItemData</span>.<span class="name">fromItem?</span></a></span><span class="decl_args">
<span class="fn">(item : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyItem">Lean.Lsp.CallHierarchyItem</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData">Lean.Server.Watchdog.CallHierarchyItemData</a></span></div></div><p>Extracts the CallHierarchyItemData from <code>item.data?</code> and returns <code>none</code> if this is not possible.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.CallHierarchyItemData.fromItem?">Lean.Server.Watchdog.CallHierarchyItemData.fromItem?</a> <span class="fn">item</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><span class="fn">item</span>.data?</span>
  <span class="fn"><span class="fn">(<a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson.fromJson?">Lean.fromJson?</a> <span class="fn">__do_lift</span>)</span>.toOption</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.CallHierarchyItemData.fromItem?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handlePrepareCallHierarchy"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L611-L622">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handlePrepareCallHierarchy"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handlePrepareCallHierarchy</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyPrepareParams">Lean.Lsp.CallHierarchyPrepareParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyItem">Lean.Lsp.CallHierarchyItem</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handlePrepareCallHierarchy" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCallHierarchyIncomingCalls"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L624-L674">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCallHierarchyIncomingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyIncomingCalls</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyIncomingCallsParams">Lean.Lsp.CallHierarchyIncomingCallsParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyIncomingCall">Lean.Lsp.CallHierarchyIncomingCall</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCallHierarchyIncomingCalls" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCallHierarchyIncomingCalls.collapseSameIncomingCalls"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L667-L674">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCallHierarchyIncomingCalls.collapseSameIncomingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyIncomingCalls</span>.<span class="name">collapseSameIncomingCalls</span></a></span><span class="decl_args">
<span class="fn">(incomingCalls : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyIncomingCall">Lean.Lsp.CallHierarchyIncomingCall</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyIncomingCall">Lean.Lsp.CallHierarchyIncomingCall</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCallHierarchyIncomingCalls.collapseSameIncomingCalls" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L676-L721">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyOutgoingCalls</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyOutgoingCallsParams">Lean.Lsp.CallHierarchyOutgoingCallsParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyOutgoingCall">Lean.Lsp.CallHierarchyOutgoingCall</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls.collapseSameOutgoingCalls"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L714-L721">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls.collapseSameOutgoingCalls"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCallHierarchyOutgoingCalls</span>.<span class="name">collapseSameOutgoingCalls</span></a></span><span class="decl_args">
<span class="fn">(outgoingCalls : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyOutgoingCall">Lean.Lsp.CallHierarchyOutgoingCall</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CallHierarchyOutgoingCall">Lean.Lsp.CallHierarchyOutgoingCall</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCallHierarchyOutgoingCalls.collapseSameOutgoingCalls" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleWorkspaceSymbol"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L723-L739">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleWorkspaceSymbol"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleWorkspaceSymbol</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.WorkspaceSymbolParams">Lean.Lsp.WorkspaceSymbolParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.SymbolInformation">Lean.Lsp.SymbolInformation</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleWorkspaceSymbol" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handlePrepareRename"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L741-L747">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handlePrepareRename"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handlePrepareRename</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.PrepareRenameParams">Lean.Lsp.PrepareRenameParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Range">Lean.Lsp.Range</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handlePrepareRename" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleRename"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L749-L765">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleRename"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRename</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.RenameParams">Lean.Lsp.RenameParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.WorkspaceEdit">Lean.Lsp.WorkspaceEdit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleRename" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidOpen"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L770-L774">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidOpen"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidOpen</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.LeanDidOpenTextDocumentParams">Lean.Lsp.LeanDidOpenTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleDidOpen" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidChange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L776-L792">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChange</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidChangeTextDocumentParams">Lean.Lsp.DidChangeTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleDidChange" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidSave"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L794-L808">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidSave"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidSave</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidSaveTextDocumentParams">Lean.Lsp.DidSaveTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>When a file is saved, notifies all file workers for files that depend on this file that this
specific import is now stale so that the file worker can issue a diagnostic asking users to
restart the file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleDidSave" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidClose"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L810-L811">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidClose"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidClose</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidCloseTextDocumentParams">Lean.Lsp.DidCloseTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidClose">Lean.Server.Watchdog.handleDidClose</a> <span class="fn">p</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.terminateFileWorker">Lean.Server.Watchdog.terminateFileWorker</a> <span class="fn"><span class="fn"><span class="fn">p</span>.textDocument</span>.uri</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleDidClose" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidChangeWatchedFiles"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L813-L840">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidChangeWatchedFiles"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChangeWatchedFiles</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Workspace.html#Lean.Lsp.DidChangeWatchedFilesParams">Lean.Lsp.DidChangeWatchedFilesParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleDidChangeWatchedFiles" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCancelRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L842-L848">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCancelRequest</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.CancelParams">Lean.Lsp.CancelParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleCancelRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.forwardNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L850-L852">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.forwardNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardNotification</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">Lean.ToJson</a> <span class="fn">α</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Server/FileSource.html#Lean.Lsp.FileSource">Lean.Lsp.FileSource</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.forwardNotification" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.parseParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L856-L861">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">parseParams</span></a></span><span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">paramType</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.parseParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.forwardRequestToWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L863-L888">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.forwardRequestToWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardRequestToWorker</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.forwardRequestToWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L890-L933">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRequest</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details id="instances-for-list-Lean.Server.Watchdog.handleRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L935-L960">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleNotification</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details id="instances-for-list-Lean.Server.Watchdog.handleNotification" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L962-L965">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleResponse</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(result : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleResponseError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L967-L975">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleResponseError</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(code : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode">Lean.JsonRpc.ErrorCode</a>)</span></span>
<span class="decl_args">
<span class="fn">(message : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(data? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.handleResponseError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.shutdown"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L979-L985">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.shutdown"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">shutdown</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.shutdown" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerEvent"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L987-L990">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerEvent</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.workerEvent">workerEvent: <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a> → <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></span></li><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.clientMsg">clientMsg: <span class="fn"><a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></li><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.clientError">clientError: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></li></ul><details id="instances-for-list-Lean.Server.Watchdog.ServerEvent" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.runClientTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L992-L1001">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.runClientTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">runClientTask</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">(<a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.runClientTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.mainLoop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1003-L1056">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mainLoop</span></a></span><span class="decl_args">
<span class="fn">(clientTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.Server.Watchdog.mkLeanServerCapabilities"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1059-L1097">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.mkLeanServerCapabilities"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mkLeanServerCapabilities</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Data/Lsp/Capabilities.html#Lean.Lsp.ServerCapabilities">Lean.Lsp.ServerCapabilities</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.mkLeanServerCapabilities" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.initAndRunWatchdogAux"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1099-L1144">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.initAndRunWatchdogAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdogAux</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.initAndRunWatchdogAux" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findWorkerPath"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1146-L1153">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findWorkerPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findWorkerPath</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.findWorkerPath" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.startLoadingReferences"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1155-L1175">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.startLoadingReferences"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startLoadingReferences</span></a></span><span class="decl_args">
<span class="fn">(references : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/References.html#Lean.Server.References">Lean.Server.References</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Starts loading .ileans present in the search path asynchronously in an IO task.
This ensures that server startup is not blocked by loading the .ileans.
In return, while the .ileans are being loaded, users will only get incomplete
results in requests that need references.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.startLoadingReferences" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.initAndRunWatchdog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1177-L1216">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.initAndRunWatchdog"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdog</span></a></span><span class="decl_args">
<span class="fn">(args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(i o e : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.initAndRunWatchdog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.watchdogMain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/410fab7284703f41660ca2454218dcca9b2ec896/src/Lean/Server/Watchdog.lean#L1218-L1228">source</a></div><div class="attributes">@[export lean_server_watchdog_main]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.watchdogMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">watchdogMain</span></a></span><span class="decl_args">
<span class="fn">(args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.Watchdog.watchdogMain" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>